# 绪论

## 1.编译

将高级语言<font color=red>源语言</font>翻译成汇编语言或机器语言<font color=red>目标语言</font>的过程。

![image](https://github.com/Einsgates/Compiler-/blob/master/%E4%B8%AA%E4%BA%BA%E7%AC%94%E8%AE%B0/img/%E7%BC%96%E8%AF%91%E5%99%A8%E4%BD%8D%E7%BD%AE.jpg)

- 预处理器：把存储在不同文件中 的源程序聚合在一起。把被称为宏的缩写语句转换为原始语句。

- 可重定位：在内存中存放的起始 位置L不是固定的。

- 加载器：修改可重定位地址； 将修改后的指令和数据放到内存中适当的位置。

- 链接器：将多个可重定位的机器代码文件（包括库文件） 连接到一起。解决外部内存地址问题。

  **起始位置 + 相对位置 = 绝对地址**

  

## 2.编译系统结构

![image](https://github.com/Einsgates/Compiler-/blob/master/%E4%B8%AA%E4%BA%BA%E7%AC%94%E8%AE%B0/img/%E7%BC%96%E8%AF%91%E5%99%A8%E7%9A%84%E7%BB%93%E6%9E%84.jpg)

## 3.词法分析

**词法分析器**从左向右逐行扫描源程序的字符，识别出各个单词，确定**单词类型**。将识别出的单词转换成统一的<font color=red>机内表示</font>——词法单元(token)形式

**token**：<种别码，属性值>

|      | 单词类型 | 种别                                                     | 种别码                                                       |
| ---- | -------- | -------------------------------------------------------- | ------------------------------------------------------------ |
| 1    | 关键字   | program, if, else, then                                  | <font color=blue>一词一码</font>                             |
| 2    | 标识符   | 变量名, 数组名, 记录名, 过程名                           | <font color=blue>多词一码</font>                             |
| 3    | 常量     | 整型, 浮点型, 字符型, 布尔型                             | <font color=blue>一型一码</font>                             |
| 4    | 运算符   | 算术(+ - * / ++ --)  关系(> < == != >= <=) 逻辑(& \| ~） | <font color=blue>一词一码</font>或<font color=blue>一型一码</font> |
| 5    | 界限符   | ; () = {}                                                | <font color=blue>一词一码</font>                             |

![image](https://github.com/Einsgates/Compiler-/blob/master/%E4%B8%AA%E4%BA%BA%E7%AC%94%E8%AE%B0/img/%E8%AF%8D%E6%B3%95%E5%88%86%E6%9E%90%E5%BE%97%E5%88%B0%E7%9A%84%E5%BA%8F%E5%88%97.jpg)



## 4.语法分析

**语法分析器**从词法分析器输出的 token 序列中识别出各类短语，并构造语法分析树。

比如：

- 赋值语句的分析树：

![image](https://github.com/Einsgates/Compiler-/blob/master/%E4%B8%AA%E4%BA%BA%E7%AC%94%E8%AE%B0/img/1-4%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90%E6%A0%91.jpg)



- 变量语句的分析树：

  ![image](https://github.com/Einsgates/Compiler-/blob/master/%E4%B8%AA%E4%BA%BA%E7%AC%94%E8%AE%B0/img/1-4%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90%E6%A0%91-2.jpg)

## 5.语义分析

任务：

**1.收集标识符的属性信息**

- 种属
- 类型
- 存储位置、长度
- 值
- 作用域
- 参数和返回值信息：参数个数、参数类型、参数传递方式、返回值类型

**2.语义检查**

- 变量或过程未经声明就使用
- 变量或过程名重复声明
- 运算分量类型不匹配
- 操作符与操作数之间的类型不匹配
  - 数组下标不是整数
  - 对非数组变量使用数组访问操作符
  - 对非过程名使用过程调用操作符
  - 过程调用的参数类型或数目不匹配
  - 函数返回类型有误

## 6.中间代码生成

#### 1.三地址码

三地址码由类似于汇编语言的指令序列组成，每个指令最多有三个操作数。

##### 1.常见三地址指令

| 序号 | 指令类型       | 指令形式                                   |
| ---- | -------------- | ------------------------------------------ |
| 1    | 赋值指令       | x = y <font color=red>op </font>z          |
| 2    | 复制指令       | x =  <font color=red>op </font>y           |
| 3    | 条件跳转       | if x <font color=red>relop </font>y goto n |
| 4    | 非条件跳转     | <font color=red>goto</font> n              |
| 5    | 参数传递       | <font color=red>param </font> x            |
| 6    | 过程调用       | <font color=red>call </font>p, n           |
| 7    | 过程返回       | <font color=red>return </font>x            |
| 8    | 数组引用       | x = y[i]                                   |
|      | 数组赋值       | x[i] = y                                   |
| 10   | 地址及指针操作 | x = &y     x= *y   *x = y                  |

地址形式：

- 源程序中的名字
- 常量
- 编译器生成的临时变量

三地址指令的表示：

- 四元式
- 三元式
- 间接三元式

四元式表示：

![image](https://github.com/Einsgates/Compiler-/blob/master/%E4%B8%AA%E4%BA%BA%E7%AC%94%E8%AE%B0/img/1-6%E4%B8%89%E5%9C%B0%E5%9D%80.jpg)

中间代码生成

![image](https://github.com/Einsgates/Compiler-/blob/master/%E4%B8%AA%E4%BA%BA%E7%AC%94%E8%AE%B0/img/1-6%E4%B8%AD%E9%97%B4%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90.jpg)

- 目标代码生成以源程序的**中间表示形式**作为输入，并把它映射到**目标语言**
- 目标代码生成的一个重要任务是为程序中使用的变量**合理分配寄存器**
- 代码优化：
  - 为改进代码所进行的**等价程序变换**，使其运行得**更快**、**占用空间更少**